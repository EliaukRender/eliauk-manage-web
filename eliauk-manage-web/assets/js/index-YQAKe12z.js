import{ap as N,aR as W,by as J,A as H,S as pe,B as U,h as Q,aU as Ee,u as de,bO as me,G as Z,w as g,bP as Te,D as ye,bQ as be,F as Se,bo as V,C as le,r as Y,_ as we,e as fe,y as Le,k as F,W as Ce,q as z,X as ee,g as _e,b as he,d as te,a8 as Oe,L as Ne}from"./index-DpyXawht.js";import{t as Ae}from"./event-CelxogyL.js";function qe(e){return e===void 0}let M;const Re=e=>{var o;if(!N)return 0;if(M!==void 0)return M;const t=document.createElement("div");t.className=`${e}-scrollbar__wrap`,t.style.visibility="hidden",t.style.width="100px",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const n=t.offsetWidth;t.style.overflow="scroll";const u=document.createElement("div");u.style.width="100%",t.appendChild(u);const r=u.offsetWidth;return(o=t.parentNode)==null||o.removeChild(t),M=n-r,M};function Je(e,o){if(!N)return;if(!o){e.scrollTop=0;return}const t=[];let n=o.offsetParent;for(;n!==null&&e!==n&&e.contains(n);)t.push(n),n=n.offsetParent;const u=o.offsetTop+t.reduce((p,E)=>p+E.offsetTop,0),r=u+o.offsetHeight,c=e.scrollTop,i=c+e.clientHeight;u<c?e.scrollTop=u:r>i&&(e.scrollTop=r-e.clientHeight)}var x=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(x||{});const X=e=>{const o=W(e)?e:[e],t=[];return o.forEach(n=>{var u;W(n)?t.push(...X(n)):J(n)&&W(n.children)?t.push(...X(n.children)):(t.push(n),J(n)&&((u=n.component)!=null&&u.subTree)&&t.push(...X(n.component.subTree)))}),t},Qe=(e,o,t,n)=>{let u={offsetX:0,offsetY:0};const r=p=>{const E=p.clientX,y=p.clientY,{offsetX:b,offsetY:S}=u,T=e.value.getBoundingClientRect(),s=T.left,a=T.top,d=T.width,l=T.height,f=document.documentElement.clientWidth,A=document.documentElement.clientHeight,R=-s+b,k=-a+S,K=f-s-d+b,w=A-a-l+S,L=_=>{let O=b+_.clientX-E,v=S+_.clientY-y;n!=null&&n.value||(O=Math.min(Math.max(O,R),K),v=Math.min(Math.max(v,k),w)),u={offsetX:O,offsetY:v},e.value&&(e.value.style.transform=`translate(${Q(O)}, ${Q(v)})`)},C=()=>{document.removeEventListener("mousemove",L),document.removeEventListener("mouseup",C)};document.addEventListener("mousemove",L),document.addEventListener("mouseup",C)},c=()=>{o.value&&e.value&&o.value.addEventListener("mousedown",r)},i=()=>{o.value&&e.value&&o.value.removeEventListener("mousedown",r)};H(()=>{pe(()=>{t.value?c():i()})}),U(()=>{i()})},Ze=(e,o={})=>{Ee(e)||Ae("[useLockscreen]","You need to pass a ref param to this function");const t=o.ns||de("popup"),n=me(()=>t.bm("parent","hidden"));if(!N||Z(document.body,n.value))return;let u=0,r=!1,c="0";const i=()=>{setTimeout(()=>{Se(document==null?void 0:document.body,n.value),r&&document&&(document.body.style.width=c)},200)};g(e,p=>{if(!p){i();return}r=!Z(document.body,n.value),r&&(c=document.body.style.width),u=Re(t.namespace.value);const E=document.documentElement.clientHeight<document.body.scrollHeight,y=Te(document.body,"overflowY");u>0&&(E||y==="scroll")&&r&&(document.body.style.width=`calc(100% - ${u}px)`),ye(document.body,n.value)}),be(()=>i())},ke=e=>{if(!e)return{onClick:V,onMousedown:V,onMouseup:V};let o=!1,t=!1;return{onClick:c=>{o&&t&&e(c),o=t=!1},onMousedown:c=>{o=c.target===c.currentTarget},onMouseup:c=>{t=c.target===c.currentTarget}}};let h=[];const oe=e=>{const o=e;o.key===le.esc&&h.forEach(t=>t(o))},Fe=e=>{H(()=>{h.length===0&&document.addEventListener("keydown",oe),N&&h.push(e)}),U(()=>{h=h.filter(o=>o!==e),h.length===0&&N&&document.removeEventListener("keydown",oe)})},$="focus-trap.focus-after-trapped",G="focus-trap.focus-after-released",Me="focus-trap.focusout-prevented",ne={cancelable:!0,bubbles:!1},Ie={cancelable:!0,bubbles:!1},se="focusAfterTrapped",ue="focusAfterReleased",De=Symbol("elFocusTrap"),j=Y(),B=Y(0),q=Y(0);let I=0;const ve=e=>{const o=[],t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const u=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||u?NodeFilter.FILTER_SKIP:n.tabIndex>=0||n===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)o.push(t.currentNode);return o},re=(e,o)=>{for(const t of e)if(!Pe(t,o))return t},Pe=(e,o)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(o&&e===o)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},ge=e=>{const o=ve(e),t=re(o,e),n=re(o.reverse(),e);return[t,n]},xe=e=>e instanceof HTMLInputElement&&"select"in e,m=(e,o)=>{if(e&&e.focus){const t=document.activeElement;e.focus({preventScroll:!0}),q.value=window.performance.now(),e!==t&&xe(e)&&o&&e.select()}};function ce(e,o){const t=[...e],n=e.indexOf(o);return n!==-1&&t.splice(n,1),t}const He=()=>{let e=[];return{push:n=>{const u=e[0];u&&n!==u&&u.pause(),e=ce(e,n),e.unshift(n)},remove:n=>{var u,r;e=ce(e,n),(r=(u=e[0])==null?void 0:u.resume)==null||r.call(u)}}},Ue=(e,o=!1)=>{const t=document.activeElement;for(const n of e)if(m(n,o),document.activeElement!==t)return},ae=He(),Ye=()=>B.value>q.value,D=()=>{j.value="pointer",B.value=window.performance.now()},ie=()=>{j.value="keyboard",B.value=window.performance.now()},Be=()=>(H(()=>{I===0&&(document.addEventListener("mousedown",D),document.addEventListener("touchstart",D),document.addEventListener("keydown",ie)),I++}),U(()=>{I--,I<=0&&(document.removeEventListener("mousedown",D),document.removeEventListener("touchstart",D),document.removeEventListener("keydown",ie))}),{focusReason:j,lastUserFocusTimestamp:B,lastAutomatedFocusTimestamp:q}),P=e=>new CustomEvent(Me,{...Ie,detail:e}),Ke=fe({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[se,ue,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:o}){const t=Y();let n,u;const{focusReason:r}=Be();Fe(s=>{e.trapped&&!c.paused&&o("release-requested",s)});const c={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},i=s=>{if(!e.loop&&!e.trapped||c.paused)return;const{key:a,altKey:d,ctrlKey:l,metaKey:f,currentTarget:A,shiftKey:R}=s,{loop:k}=e,K=a===le.tab&&!d&&!l&&!f,w=document.activeElement;if(K&&w){const L=A,[C,_]=ge(L);if(C&&_){if(!R&&w===_){const v=P({focusReason:r.value});o("focusout-prevented",v),v.defaultPrevented||(s.preventDefault(),k&&m(C,!0))}else if(R&&[C,L].includes(w)){const v=P({focusReason:r.value});o("focusout-prevented",v),v.defaultPrevented||(s.preventDefault(),k&&m(_,!0))}}else if(w===L){const v=P({focusReason:r.value});o("focusout-prevented",v),v.defaultPrevented||s.preventDefault()}}};Le(De,{focusTrapRef:t,onKeydown:i}),g(()=>e.focusTrapEl,s=>{s&&(t.value=s)},{immediate:!0}),g([t],([s],[a])=>{s&&(s.addEventListener("keydown",i),s.addEventListener("focusin",y),s.addEventListener("focusout",b)),a&&(a.removeEventListener("keydown",i),a.removeEventListener("focusin",y),a.removeEventListener("focusout",b))});const p=s=>{o(se,s)},E=s=>o(ue,s),y=s=>{const a=F(t);if(!a)return;const d=s.target,l=s.relatedTarget,f=d&&a.contains(d);e.trapped||l&&a.contains(l)||(n=l),f&&o("focusin",s),!c.paused&&e.trapped&&(f?u=d:m(u,!0))},b=s=>{const a=F(t);if(!(c.paused||!a))if(e.trapped){const d=s.relatedTarget;!Ce(d)&&!a.contains(d)&&setTimeout(()=>{if(!c.paused&&e.trapped){const l=P({focusReason:r.value});o("focusout-prevented",l),l.defaultPrevented||m(u,!0)}},0)}else{const d=s.target;d&&a.contains(d)||o("focusout",s)}};async function S(){await ee();const s=F(t);if(s){ae.push(c);const a=s.contains(document.activeElement)?n:document.activeElement;if(n=a,!s.contains(a)){const l=new Event($,ne);s.addEventListener($,p),s.dispatchEvent(l),l.defaultPrevented||ee(()=>{let f=e.focusStartEl;_e(f)||(m(f),document.activeElement!==f&&(f="first")),f==="first"&&Ue(ve(s),!0),(document.activeElement===a||f==="container")&&m(s)})}}}function T(){const s=F(t);if(s){s.removeEventListener($,p);const a=new CustomEvent(G,{...ne,detail:{focusReason:r.value}});s.addEventListener(G,E),s.dispatchEvent(a),!a.defaultPrevented&&(r.value=="keyboard"||!Ye()||s.contains(document.activeElement))&&m(n??document.body),s.removeEventListener(G,E),ae.remove(c)}}return H(()=>{e.trapped&&S(),g(()=>e.trapped,s=>{s?S():T()})}),U(()=>{e.trapped&&T()}),{onKeydown:i}}});function We(e,o,t,n,u,r){return z(e.$slots,"default",{handleKeydown:e.onKeydown})}var et=we(Ke,[["render",We],["__file","focus-trap.vue"]]);const Ve=he({mask:{type:Boolean,default:!0},customMaskEvent:{type:Boolean,default:!1},overlayClass:{type:te([String,Array,Object])},zIndex:{type:te([String,Number])}}),Xe={click:e=>e instanceof MouseEvent},$e="overlay";var Ge=fe({name:"ElOverlay",props:Ve,emits:Xe,setup(e,{slots:o,emit:t}){const n=de($e),u=p=>{t("click",p)},{onClick:r,onMousedown:c,onMouseup:i}=ke(e.customMaskEvent?void 0:u);return()=>e.mask?Oe("div",{class:[n.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:r,onMousedown:c,onMouseup:i},[z(o,"default")],x.STYLE|x.CLASS|x.PROPS,["onClick","onMouseup","onMousedown"]):Ne("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[z(o,"default")])}});const tt=Ge;export{tt as E,De as F,Ze as a,et as b,ke as c,X as f,qe as i,Je as s,Qe as u};
